# Code generation of database entity and DAO classes

## Generation of serialVersionUID values

Each entity class must be serializable, which means it must have a
`serialVersionUID` value. These values are generated by the JDK tool
`serialver`.

The `generate-jpa-entities-daos.xsl` XSLT has a mode in which entity
classes are generated _without_ `serialVersionUID` values. Then, the
`serialver` tool is run on the generated code. The resulting value is
then inserted into `registry-db-entity-map.xml`, and then the entity
classes are regenerated _with_ `serialVersionUID` values.

To generate entity classes without `serialVersionUID` values, specify
`generate-serialVersionUIDs=false` on the Saxon command line.

### Steps in detail

First, ensure that the new tables are added to
`registry-db-entity-map.xml` with dummy `serialVersionUID` values.

Then, generate an up-to-date "flatted" database spec:

```
ant generate-flattened-registry-db-spec
```

Then run Saxon:

```
java -cp tools/dist/SaxonHE9-7-0-14J/saxon9he.jar net.sf.saxon.Transform \
 generate-serialVersionUIDs=false, \
 -s:build-liquibase/flattened-registry.xml \
 -xsl:src/main/db/code-generation/generate-jpa-entities-daos.xsl \
 -o:genned-entities.txt
```

Then:

```
ant compile-main
rm -r bin-tmp
mkdir bin-tmp
javac \
-cp lib/hibernate-5.2.5/hibernate-jpa-2.1-api-1.0.0.Final.jar:build \
-d bin-tmp au/org/ands/vocabs/registry/db/entity/*
h=
for f in bin-tmp/au/org/ands/vocabs/registry/db/entity/* ; do
  echo $f
  g=${f#bin-tmp/}
  g=${g%.class}
  g=${g//\//.}
  h="$h $g"
done
echo h is $h
serialver -classpath bin-tmp:build $h
rm -r bin-tmp
```

Then edit `registry-db-entity-map.xml` and replace the dummy values
with the newly-created `serialVersionUID` values.

Then run `ant clean` and then `ant` to rebuild the entity classes with
`serialVersionUID` values.
